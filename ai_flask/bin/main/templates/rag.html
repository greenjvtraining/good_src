<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>RAG í…ŒìŠ¤íŠ¸ í˜ì´ì§€</title>
    <style>
        body { font-family: Arial; margin: 2em; }
        textarea { width: 100%; height: 100px; }
        button { margin-top: 1em; padding: 10px 20px; }
        #response { margin-top: 2em; white-space: pre-wrap; border: 1px solid #ccc; padding: 1em; }
    </style>
</head>
<body>
    <h2>ğŸ“„ ë¬¸ì„œ ì—…ë¡œë“œ (ì„ë² ë”©)</h2>
    <form id="uploadForm">
        <textarea id="docInput" placeholder="ë¬¸ì„œë¥¼ ì…ë ¥í•˜ì„¸ìš”..."></textarea><br>
        <button type="submit">ë¬¸ì„œ ì—…ë¡œë“œ</button>
    </form>

    <h2>â“ ì§ˆë¬¸í•˜ê¸° (RAG)</h2>
    <form id="askForm">
        <textarea id="questionInput" placeholder="ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”..."></textarea><br>
        <button type="submit">ì§ˆë¬¸ ë³´ë‚´ê¸°</button>
    </form>

    <h2>ğŸ“‹ ì €ì¥ëœ ë¬¸ì„œ ëª©ë¡</h2>
    <button onclick="loadDocs()">ë¬¸ì„œ ë¶ˆëŸ¬ì˜¤ê¸°</button>
    <ul id="docList"></ul>

    <h2>ğŸ’¬ ì‘ë‹µ ê²°ê³¼</h2>
    <div id="response"></div>

    <script>
        document.getElementById("uploadForm").addEventListener("submit", function(e) {
            e.preventDefault();
            const content = document.getElementById("docInput").value;
            fetch("/api/rag/upload", {
                method: "POST",
                headers: { "Content-Type": "text/plain; charset=UTF-8" },
                body: content
            })
            .then(res => res.text())
            .then(msg => document.getElementById("response").textContent = "âœ… " + msg)
            .catch(err => console.error(err));
        });

        document.getElementById("askForm").addEventListener("submit", function(e) {
            e.preventDefault();
            const question = document.getElementById("questionInput").value;
            fetch("/api/rag/ask", {
                method: "POST",
                headers: { "Content-Type": "text/plain; charset=UTF-8" },
                body: question
            })
            .then(res => res.text())
            .then(answer => document.getElementById("response").textContent = "ğŸ’¡ " + answer)
            .catch(err => console.error(err));
        });

        function loadDocs() {
            fetch("/api/rag/docs")
                .then(res => res.json())
                .then(data => {
                	console.log(data);
                    const ul = document.getElementById("docList");
                    ul.innerHTML = "";
                    data.documents.forEach(doc => {
                        const li = document.createElement("li");
                        li.textContent = doc.substring(0, 100) + "...";
                        ul.appendChild(li);
                    });
                })
                .catch(err => console.error(err));
        }
    </script>
</body>
</html>
